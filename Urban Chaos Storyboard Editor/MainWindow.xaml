<Window x:Class="UrbanChaosStoryboardEditor.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:views="clr-namespace:UrbanChaosStoryboardEditor.Views"
        Title="{Binding WindowTitle}"
        Height="800" Width="1200"
        WindowStartupLocation="CenterScreen"
        Background="#1E1E1E">

    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis"/>
    </Window.Resources>

    <Window.InputBindings>
        <KeyBinding Key="N" Modifiers="Ctrl" Command="{Binding NewCommand}"/>
        <KeyBinding Key="O" Modifiers="Ctrl" Command="{Binding OpenCommand}"/>
        <KeyBinding Key="S" Modifiers="Ctrl" Command="{Binding SaveCommand}"/>
    </Window.InputBindings>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Menu Bar -->
        <Menu Grid.Row="0" Background="#E0E0E0" Foreground="Black">
            <MenuItem Header="_File">
                <MenuItem Header="_New" Command="{Binding NewCommand}" InputGestureText="Ctrl+N"/>
                <MenuItem Header="_Open..." Command="{Binding OpenCommand}" InputGestureText="Ctrl+O"/>
                <Separator/>
                <MenuItem Header="_Save" Command="{Binding SaveCommand}" InputGestureText="Ctrl+S"/>
                <MenuItem Header="Save _As..." Command="{Binding SaveAsCommand}"/>
                <Separator/>
                <MenuItem Header="E_xit" Command="{Binding ExitCommand}"/>
            </MenuItem>
            <MenuItem Header="_Help">
                <MenuItem Header="_About Urban Chaos Storyboard Editor"/>
            </MenuItem>
        </Menu>

        <!-- Toolbar -->
        <ToolBar Grid.Row="1" Background="#2D2D2D">
            <ToolBar.Resources>
                <Style TargetType="Button">
                    <Setter Property="Foreground" Value="White"/>
                    <Setter Property="Background" Value="#3A3A3A"/>
                    <Setter Property="BorderBrush" Value="#666"/>
                    <Setter Property="BorderThickness" Value="1"/>
                    <Setter Property="Padding" Value="8,4"/>
                    <Setter Property="Margin" Value="2"/>
                </Style>
            </ToolBar.Resources>
            <Button Content="📄 New" Foreground="White" Command="{Binding NewCommand}"/>
            <Button Content="📂 Open" Foreground="White" Command="{Binding OpenCommand}"/>
            <Button Content="💾 Save" Foreground="White" Command="{Binding SaveCommand}"/>
            <Separator Margin="8,0"/>
            <TextBlock Text="Districts:" Foreground="White" VerticalAlignment="Center" Margin="4,0"/>
            <TextBlock x:Name="DistrictCountText" Text="0" 
                       Foreground="#4FC3F7" VerticalAlignment="Center" Margin="4,0"/>
            <Separator Margin="8,0"/>
            <TextBlock Text="Missions:" Foreground="White" VerticalAlignment="Center" Margin="4,0"/>
            <TextBlock x:Name="MissionCountText" Text="0" 
                       Foreground="#81C784" VerticalAlignment="Center" Margin="4,0"/>
        </ToolBar>

        <!-- Main Content -->
        <Grid Grid.Row="2">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="5"/>
                <ColumnDefinition Width="350"/>
            </Grid.ColumnDefinitions>

            <!-- Map View with District Markers -->
            <Border Grid.Column="0" BorderBrush="#444" BorderThickness="1" Background="#252526">
                <Grid>
                    <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto">
                        <Canvas x:Name="MapCanvas" Width="640" Height="480" Background="#1A1A1A">
                            <!-- Background image (shown when file is loaded) -->
                            <Image x:Name="MapBackgroundImage" 
                       Source="Assets/Images/storyboard_map.png"
                       Width="640" Height="480"
                       Stretch="None"
                       Visibility="Collapsed"/>

                            <!-- District markers -->
                            <ItemsControl x:Name="DistrictMarkers">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <Canvas/>
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Canvas>
                                            <!-- Pin marker (ellipse) -->
                                            <Ellipse x:Name="Pin"
                         Width="12" Height="12"
                         Fill="#E53935" 
                         Stroke="#B71C1C" StrokeThickness="2"
                         Canvas.Left="-6" Canvas.Top="-6"
                         Cursor="Hand"
                         MouseLeftButtonUp="Pin_MouseLeftButtonUp"
                         Tag="{Binding}">
                                                <Ellipse.Effect>
                                                    <DropShadowEffect ShadowDepth="2" BlurRadius="4" Opacity="0.5"/>
                                                </Ellipse.Effect>
                                                <Ellipse.ContextMenu>
                                                    <ContextMenu x:Name="PinContextMenu" 
                                     Opened="PinContextMenu_Opened"
                                     Tag="{Binding}">
                                                        <MenuItem Header="No missions" IsEnabled="False"/>
                                                    </ContextMenu>
                                                </Ellipse.ContextMenu>
                                            </Ellipse>

                                            <!-- Name badge (hidden by default, shows on hover) -->
                                            <Border x:Name="NameBadge"
                        Canvas.Left="10" Canvas.Top="-10"
                        Background="#333333"
                        BorderBrush="#555555"
                        BorderThickness="1"
                        CornerRadius="3"
                        Padding="6,3"
                        Opacity="0"
                        IsHitTestVisible="False">
                                                <Border.Effect>
                                                    <DropShadowEffect ShadowDepth="2" BlurRadius="4" Opacity="0.5"/>
                                                </Border.Effect>
                                                <TextBlock Text="{Binding DistrictName}" 
                               Foreground="White" 
                               FontSize="11"
                               FontWeight="SemiBold"/>
                                            </Border>

                                            <Canvas.RenderTransform>
                                                <TranslateTransform X="{Binding XPos}" Y="{Binding YPos}"/>
                                            </Canvas.RenderTransform>

                                            <!-- Triggers for hover effect -->
                                            <Canvas.Triggers>
                                                <EventTrigger RoutedEvent="MouseEnter">
                                                    <BeginStoryboard>
                                                        <Storyboard>
                                                            <DoubleAnimation Storyboard.TargetName="NameBadge"
                                                 Storyboard.TargetProperty="Opacity"
                                                 To="1" Duration="0:0:0.15"/>
                                                            <DoubleAnimation Storyboard.TargetName="Pin"
                                                 Storyboard.TargetProperty="Width"
                                                 To="16" Duration="0:0:0.1"/>
                                                            <DoubleAnimation Storyboard.TargetName="Pin"
                                                 Storyboard.TargetProperty="Height"
                                                 To="16" Duration="0:0:0.1"/>
                                                        </Storyboard>
                                                    </BeginStoryboard>
                                                </EventTrigger>
                                                <EventTrigger RoutedEvent="MouseLeave">
                                                    <BeginStoryboard>
                                                        <Storyboard>
                                                            <DoubleAnimation Storyboard.TargetName="NameBadge"
                                                 Storyboard.TargetProperty="Opacity"
                                                 To="0" Duration="0:0:0.15"/>
                                                            <DoubleAnimation Storyboard.TargetName="Pin"
                                                 Storyboard.TargetProperty="Width"
                                                 To="12" Duration="0:0:0.1"/>
                                                            <DoubleAnimation Storyboard.TargetName="Pin"
                                                 Storyboard.TargetProperty="Height"
                                                 To="12" Duration="0:0:0.1"/>
                                                        </Storyboard>
                                                    </BeginStoryboard>
                                                </EventTrigger>
                                            </Canvas.Triggers>
                                        </Canvas>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </Canvas>
                    </ScrollViewer>

                    <!-- Placeholder when no file loaded -->
                    <TextBlock x:Name="PlaceholderText"
                   Text="Open or create a storyboard file to begin"
                   Foreground="#666" FontSize="16"
                   HorizontalAlignment="Center" VerticalAlignment="Center"/>
                </Grid>
            </Border>

            <GridSplitter Grid.Column="1" Width="5" HorizontalAlignment="Stretch" Background="#333"/>

            <!-- Right Panel with Tabs -->
            <Border Grid.Column="2" BorderBrush="#444" BorderThickness="1" Background="#252526">
                <TabControl Background="#252526" BorderThickness="0">
                    <TabControl.Resources>
                        <Style TargetType="TabItem">
                            <Setter Property="Background" Value="#3C3C3C"/>
                            <Setter Property="Foreground" Value="White"/>
                            <Setter Property="Padding" Value="12,6"/>
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="TabItem">
                                        <Border x:Name="Border" Background="{TemplateBinding Background}" 
                                                BorderBrush="#555" BorderThickness="1,1,1,0" 
                                                Padding="{TemplateBinding Padding}">
                                            <ContentPresenter ContentSource="Header" HorizontalAlignment="Center"/>
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsSelected" Value="True">
                                                <Setter TargetName="Border" Property="Background" Value="#252526"/>
                                            </Trigger>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter TargetName="Border" Property="Background" Value="#4C4C4C"/>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </TabControl.Resources>

                    <TabItem Header="Districts">
                        <views:DistrictsPanel x:Name="DistrictsPanel"/>
                    </TabItem>

                    <TabItem Header="Missions">
                        <views:MissionsPanel x:Name="MissionsPanel"/>
                    </TabItem>
                </TabControl>
            </Border>
        </Grid>

        <!-- Status Bar - WHITE -->
        <StatusBar Grid.Row="3" Background="White" Foreground="Black">
            <StatusBarItem>
                <TextBlock Text="{Binding StatusText}"/>
            </StatusBarItem>
            <Separator/>
            <StatusBarItem HorizontalAlignment="Right">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="File: "/>
                    <TextBlock x:Name="FilePathText" Text="(none)" Foreground="#333"/>
                </StackPanel>
            </StatusBarItem>
        </StatusBar>
    </Grid>
</Window>